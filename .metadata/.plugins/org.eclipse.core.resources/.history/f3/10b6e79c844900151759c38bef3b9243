package trb1914;

import java.awt.BorderLayout;
import java.awt.GridLayout;

import javax.swing.JPanel;
import javax.swing.SwingUtilities;

import trb1914.data.Statistics;
import trb1914.data.StatisticsCalculator;
import trb1914.util.DatesView;
/**
 * The view that displays any statistics
 * @author Mees Gelein
 */
public class StatisticsView extends JPanel{

	/**The statistics that are displayed*/
	private Statistics stats;
	/**Displays the amount of items that return each day*/
	private DatesView returnView = new DatesView("Terugkerende Items");
	/**Displays the amount of customers on each day*/
	private DatesView customerView = new DatesView("Klanten");
	/**Displays the amount of items rented each day*/
	private DatesView rentView = new DatesView("Verhuurde Items");
	
	/**
	 * Creates the StatisticsView
	 */
	public StatisticsView() {
		makeGUI();
		refresh();
	}
	
	/**
	 * Creates the display components that will show the statistics data
	 */
	private void makeGUI(){
		setLayout(new BorderLayout());
		JPanel contentPanel = new JPanel(new GridLayout(2, 2));
		add(contentPanel);
		
		contentPanel.add(returnView);
		contentPanel.add(customerView);
		contentPanel.add(rentView);
	}
	
	/**
	 * Refreshes (recalculates) the statistics on a separate thread and refreshes the display 
	 * when the calculations are done
	 */
	public void refresh(){
		new Thread(new Runnable(){
			public void run() {
				stats = StatisticsCalculator.getNewStatistics();
				SwingUtilities.invokeLater(new Runnable() {
					public void run() {
						loadStats();
						revalidate();
						repaint();
					}
				});
			}
		}).start();
	}
	
	/**
	 * Loads the statistics into the view components
	 */
	private void loadStats(){
		customerView.set("20-08-2015", "26-08-2015", stats.customerAmount);
		rentView.set("20-08-2015", "26-08-2015", stats.rentAmount);
	}
}
